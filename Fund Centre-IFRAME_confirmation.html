<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<head><meta charset="utf-8">
<style>
</style>
</head>
<body>
  
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
  Click here to activate fund centre
</button>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Confirmation</h4>
      </div>
      <div class="modal-body">
         <p>By clicking the activate button, the fund centre will be active and ready to be used in production for new applications and new budget entries. You will be able to edit the details of this fund centre after activating however the changes will be saved as amendments to the fund centre for auditing and data integrity purposes.
      </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" id="confirmActivate" class="btn btn-primary" data-dismiss="modal">Confirm</button>
      </div>
    </div>
  </div>
</div>
 

<script type="text/javascript">
var context = parent.window
var entityId = context.Xrm.Page.data.entity.getId()
context.Xrm.Page.getAttribute("statuscode").setSubmitMode("always");
// context.Xrm.Page.getAttribute("statuscode").addOnChange(refreshStatus)

function refreshStatus() {
  console.log("refreshed");
  // context.Xrm.Page.data.entity.save()
  // var subgrid = Xrm.Page.ui.controls.get("AnnualBudgets");
  // subgrid .refresh();
}
$(document).on("click", "#confirmActivate", function() {
  // context.Xrm.Page.getAttribute("statuscode").setDisabled(false)
  context.Xrm.Page.getAttribute("statuscode").setValue(148030011);  
  // context.Xrm.Page.data.entity.save()
  context.Xrm.Page.getAttribute("statuscode").fireOnChange();
  // context.Xrm.Page.getAttribute("statuscode").setDisabled(true)
  context.Xrm.Utility.openEntityForm("gcbase_fundcentre", entityId);

})


</script>

</body></html>